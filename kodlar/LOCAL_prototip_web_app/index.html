<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Belge Doğrulama Prototipi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border-left-color: #09f;
        animation: spin 1s ease infinite;
      }
      .file-selected-icon {
        color: #28a745;
        margin-left: 8px;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body
    class="bg-gradient-to-br from-gray-100 to-blue-50 min-h-screen flex items-center justify-center p-4"
  >
    <div class="bg-white rounded-xl shadow-2xl p-8 md:p-12 w-full max-w-2xl">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-800 text-center mb-4">
        Belge ve Kimlik Doğrulama
      </h1>
      <p class="text-gray-600 text-center mb-8">
        Lütfen kimlik kartı ve imzalı belge görsellerini yükleyin.
      </p>

      <form id="uploadForm" enctype="multipart/form-data" class="space-y-6">
        <div
          id="kimlikInputArea"
          class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-500 hover:bg-gray-50 transition-colors duration-300"
        >
          <label
            for="kimlikDosya"
            class="cursor-pointer text-blue-600 font-semibold"
          >
            <i class="fas fa-id-card mr-2"></i> 1. Kimlik Kartı Yükle
          </label>
          <input
            type="file"
            id="kimlikDosya"
            name="kimlik"
            accept="image/*"
            required
            class="hidden"
          />
          <span
            id="kimlikDosyaAdi"
            class="ml-3 text-sm text-gray-500 block mt-2"
          ></span>
        </div>

        <div
          id="formInputArea"
          class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-500 hover:bg-gray-50 transition-colors duration-300"
        >
          <label
            for="formDosya"
            class="cursor-pointer text-blue-600 font-semibold"
          >
            <i class="fas fa-file-signature mr-2"></i> 2. Belge Yükle
          </label>
          <input
            type="file"
            id="formDosya"
            name="form"
            accept="image/*"
            required
            class="hidden"
          />
          <span
            id="formDosyaAdi"
            class="ml-3 text-sm text-gray-500 block mt-2"
          ></span>
        </div>

        <button
          type="submit"
          id="submitButton"
          class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Doğrula
        </button>
      </form>

      <div id="spinner" class="spinner mx-auto my-6 hidden"></div>

      <div id="sonucAlani" class="mt-8 p-6 rounded-lg bg-gray-50 border hidden">
        {/* Sonuç içeriği JavaScript ile buraya eklenecek */}
      </div>

      <footer class="text-center text-gray-400 text-sm mt-12">
        Created by Emir Yorgun
      </footer>
    </div>

    <script>
      const form = document.getElementById("uploadForm");
      const submitButton = document.getElementById("submitButton");
      const spinner = document.getElementById("spinner");
      const sonucAlani = document.getElementById("sonucAlani");
      const kimlikDosyaInput = document.getElementById("kimlikDosya");
      const formDosyaInput = document.getElementById("formDosya");
      const kimlikDosyaAdi = document.getElementById("kimlikDosyaAdi");
      const formDosyaAdi = document.getElementById("formDosyaAdi");

      const updateFileName = (input, spanElement) => {
        const fileName = input.files[0] ? input.files[0].name : "";
        spanElement.innerHTML = fileName
          ? `${fileName} <i class="fas fa-check-circle file-selected-icon"></i>`
          : "";
      };

      kimlikDosyaInput.onchange = () =>
        updateFileName(kimlikDosyaInput, kimlikDosyaAdi);
      formDosyaInput.onchange = () =>
        updateFileName(formDosyaInput, formDosyaAdi);

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!kimlikDosyaInput.files[0] || !formDosyaInput.files[0]) {
          // Daha modern bir uyarı için (isteğe bağlı)
          // alert yerine küçük bir modal veya bildirim kullanabilirsiniz.
          alert("Lütfen her iki dosyayı da seçin.");
          return;
        }

        submitButton.disabled = true;
        spinner.style.display = "block";
        sonucAlani.style.display = "none";
        sonucAlani.classList.remove(
          "border-l-4",
          "border-green-500",
          "border-red-500",
          "bg-green-50",
          "bg-red-50"
        ); // Tailwind sınıflarını temizle

        const formData = new FormData();
        formData.append("kimlik", kimlikDosyaInput.files[0]);
        formData.append("form", formDosyaInput.files[0]);

        try {
          const response = await fetch("/dogrula", {
            method: "POST",
            body: formData,
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.detail || "Bir hata oluştu.");
          }

          sonucAlani.style.display = "block";
          let html = "";
          let icon = "";
          let titleColor = "";
          let borderColor = "";
          let bgColor = "";

          if (data.sonuc === "Olumlu") {
            icon = `<i class="fas fa-check-circle text-green-500 mr-2"></i>`;
            titleColor = "text-green-700";
            borderColor = "border-green-500";
            bgColor = "bg-green-50";
          } else {
            icon = `<i class="fas fa-times-circle text-red-500 mr-2"></i>`;
            titleColor = "text-red-700";
            borderColor = "border-red-500";
            bgColor = "bg-red-50";
          }

          sonucAlani.classList.add("border-l-4", borderColor, bgColor);

          html = `<h2 class="text-xl font-semibold ${titleColor} mb-3">${icon}${data.sonuc}</h2>`;
          html += '<ul class="list-disc list-inside text-gray-700 space-y-1">';
          data.detaylar.forEach((detay) => {
            html += `<li>${detay}</li>`;
          });
          html += "</ul>";

          sonucAlani.innerHTML = html;
        } catch (error) {
          sonucAlani.style.display = "block";
          sonucAlani.classList.add("border-l-4", "border-red-500", "bg-red-50");
          sonucAlani.innerHTML = `<h2 class="text-xl font-semibold text-red-700 mb-3"><i class="fas fa-exclamation-triangle mr-2"></i>Hata</h2><p class="text-gray-700">${error.message}</p>`;
        } finally {
          submitButton.disabled = false;
          spinner.style.display = "none";
        }
      });
    </script>
  </body>
</html>
